<!DOCTYPE html>
<html>

<head>
<!-- åœ¨<head>å€åŸŸå…§å¼•å…¥Socket.IOåº« -->
    <script src="socket.io.js"></script>
    <title>å­¸ç”Ÿå›ç­”ç³»çµ±</title>
    <style>
        #chatbox {
            border: 1px solid #ccc;
            height: 300px;
            overflow: auto;
            padding: 10px;
        }

        img {
            max-width: 100%;
            max-height: 200px; /* æ ¹æ“šéœ€è¦èª¿æ•´ */
            cursor: pointer;
        }

        #statusBar {
            margin-top: 10px;
        }

/* Modal */
.modal {
    display: none;
    position: fixed;
    z-index: 1;
    padding-top: 50px;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.9);
    overflow: auto;
}

.modal-content {
    margin: auto;
    display: block;
    max-width: 90%;
    max-height: 80%;
}

.close {
    color: #ffffff;
    position: absolute;
    top: 15px;
    right: 35px;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
    cursor: pointer;
}

.close:hover {
    color: #f44336;
}
    </style>
</head>

<body>
    <div id="roleSelection">
    <h1>é¸æ“‡èº«ä»½</h1>
        <button id="teacherButton" onclick="showTeacherCodePrompt()">æ•™å¸«</button>
        <button id="studentButton" onclick="setRole('student')">å­¸ç”Ÿ</button>
    </div>

    <div id="studentSection" style="display: none;">
        <h2>å­¸ç”Ÿé¸æ“‡åº§è™Ÿ</h2>
        <select id="studentId">
            <option value="">è«‹é¸æ“‡åº§è™Ÿ</option>
            <script>
                for (let i = 1; i <= 50; i++) {
                    document.write(`<option value="${i}">${i}</option>`);
                }
            </script>
        </select>
        <label for="studentName">è¼¸å…¥å§“åï¼š</label>
        <input type="text" id="studentName" placeholder="è«‹è¼¸å…¥å§“å..." />
        <button onclick="chooseStudentAndName()">ç¢ºå®š</button>
    </div>

        <div id="statusBar" style="display: none;">
            <h3>å­¸ç”Ÿï¼š<span id="studentInfoName"></span> (åº§è™Ÿ <span id="studentInfoId"></span>)</h3>
        </div>

        <div id="studentOptions" style="display: none;">
            <button onclick="selectAnswer(1)">é¸é … 1</button>
            <button onclick="selectAnswer(2)">é¸é … 2</button>
            <button onclick="selectAnswer(3)">é¸é … 3</button>
            <button onclick="selectAnswer(4)">é¸é … 4</button>
        </div>


    <h2>å…±åŒçš„èŠå¤©å®¤</h2>
    <div id="currentQuestion" style="display: none;"></div>
    <div id="chatbox"></div>

    <div id="messageInput" style="display: none;">
        <input type="text" id="message" placeholder="è«‹è¼¸å…¥è¨Šæ¯..." />
        <button onclick="sendMessage()">é€å‡º</button>
        <button onclick="openEmojiPicker()">é¸æ“‡ Emoji</button>
        <input type="file" id="imageInput" accept="image/*" onchange="handleImageSelect()">
    </div>

    <div id="emojiPicker" style="display: none;">
        <button onclick="insertEmoji('ğŸ˜€')">ğŸ˜€</button>
        <button onclick="insertEmoji('ğŸ˜ƒ')">ğŸ˜ƒ</button>
        <button onclick="insertEmoji('ğŸ˜„')">ğŸ˜„</button>
    </div>

<div id="teacherSection" style="display: none;">
    <h2>æ•™å¸«è¨­ç½®å•é¡Œ</h2>
    <button onclick="startNewQuestion()">è¨­ç½®å•é¡Œ</button>
    <button onclick="showStudentAnswers()">æŸ¥çœ‹çµ±è¨ˆ</button>
    <button onclick="endQuestion()">çµæŸå•é¡Œ</button>
        <button onclick="resetSystem()">é‡ç½®å•é¡Œ</button>

<div id="imageModal" class="modal">
    <span class="close" onclick="closeImageModal()">&times;</span>
    <img id="modalImage" class="modal-content">
</div>

    <script>
        let role = "";
        let currentQuestion = "";
        let studentAnswers = {};
        let onlineStudents = [];
        let answerCounts = { 1: 0, 2: 0, 3: 0, 4: 0 };
        let modal = document.getElementById("imageModal");
        let modalImage = document.getElementById("modalImage");
        const correctCode = "1234";
        const chatbox = document.getElementById("chatbox");
        const messageInput = document.getElementById("messageInput");
        const teacherButton = document.getElementById("teacherButton");
        const studentButton = document.getElementById("studentButton");
        const emojiPicker = document.getElementById("emojiPicker");
        const imageInput = document.getElementById("imageInput");
        const roleSelection = document.getElementById("roleSelection");
        const statusBar = document.getElementById("statusBar");
        const teacherSection = document.getElementById("teacherSection");
 
        // é€£ç·šåˆ°Socket.IOä¼ºæœå™¨
    const socket = io();

        // è¨­å®šèº«ä»½ç‚ºæ•™å¸«æˆ–å­¸ç”Ÿ
        function setRole(selectedRole) {
            role = selectedRole;
            roleSelection.style.display = "none";
            if (role === "student") {
                document.getElementById("studentOptions").style.display = "none";
                document.getElementById("studentSection").style.display = "block";
                teacherSection.style.display = "none";




            } else if (role === "teacher") {
                document.getElementById("teacherSection").style.display = "block";
                document.getElementById("messageInput").style.display = "block";
                const statusBar = document.getElementById("statusBar");
                statusBar.innerHTML = `<span style="font-size: 20px;font-weight: bold;">èº«åˆ†ï¼šæ•™å¸«</span>`;
                document.getElementById("statusBar").style.display = "block";
            }
        }


        // é¡¯ç¤ºæ•™å¸«é©—è­‰ç¢¼æç¤º
        function showTeacherCodePrompt() {
            const enteredCode = prompt("è¼¸å…¥é©—è­‰ç¢¼ï¼š");
            if (enteredCode === correctCode) {
                setRole("teacher");

            } else {
                alert("é©—è­‰ç¢¼éŒ¯èª¤ï¼Œç„¡æ³•é¸æ“‡æ•™å¸«èº«ä»½ã€‚");
            }
        }

        // é¸æ“‡å­¸ç”Ÿåº§è™Ÿå’Œå§“å
        function chooseStudentAndName() {
            const studentId = document.getElementById("studentId").value;
            const studentName = document.getElementById("studentName").value;
            if (studentId && studentName) {
                onlineStudents.push({ id: studentId, name: studentName });
                document.getElementById("studentInfoName").textContent = studentName;
                document.getElementById("studentInfoId").textContent = studentId;
                document.getElementById("messageInput").style.display = "block";
                role = "student";
                document.getElementById("statusBar").style.display = "block";
                document.getElementById("studentSection").style.display = "none";
            }
        }

        // é¸æ“‡ç­”æ¡ˆ
        function selectAnswer(answer) {
            const studentId = document.getElementById("studentId").value;
            const studentName = document.getElementById("studentName").value;
            appendToChat(`å­¸ç”Ÿ ${studentName} (åº§è™Ÿ ${studentId}) é¸æ“‡äº†é¸é … ${answer}`);
            answerCounts[answer]++;
        // é¡¯ç¤ºç•¶å‰å•é¡Œ
    if (currentQuestion) {
        appendToChat(`<strong>ç›®å‰å•é¡Œï¼š"${currentQuestion}"</strong>`);
    }
        }

        // é¡¯ç¤ºå­¸ç”Ÿå›ç­”çµ±è¨ˆ
        function showStudentAnswers() {
            if (role === "teacher") {
                let answerList = "å­¸ç”Ÿå›ç­”çµ±è¨ˆï¼š\n";
                for (const [answer, count] of Object.entries(answerCounts)) {
                    answerList += `é¸é … ${answer}: ${count} æ¬¡\n`;
                }
                appendToChat(answerList);
            }

        }


        // é‡ç½®ç³»çµ±(é‡ç½®å•é¡Œ)
        function resetSystem() {
            currentQuestion = "";
            studentAnswers = {};
            answerCounts = { 1: 0, 2: 0, 3: 0, 4: 0 };
            currentQuestion = ""; // é‡ç½®ç›®å‰å•é¡Œ
    
            // éš±è—é¡¯ç¤ºå•é¡Œçš„ <div>
            const currentQuestionDiv = document.getElementById("currentQuestion");
            currentQuestionDiv.style.display = "none";
        }


        // é¡¯ç¤ºæ•™å¸«è¨­å®šçš„å•é¡Œè¼¸å…¥æ¡†
        function showQuestionInput() {
            if (role === "teacher") {
                const questionInput = prompt("è«‹è¼¸å…¥å•é¡Œï¼š");
                if (questionInput) {
                    currentQuestion = questionInput;
                    appendToChat(`æ•™å¸«è¨­å®šå•é¡Œï¼š${currentQuestion}`);
        // é¡¯ç¤ºç›®å‰å•é¡Œ
        const currentQuestionDiv = document.getElementById("currentQuestion");
        currentQuestionDiv.innerHTML = `<strong>ç›®å‰å•é¡Œï¼š"${currentQuestion}"</strong>`;
        currentQuestionDiv.style.display = "block";
                }
            }
            document.getElementById("studentOptions").style.display = "block";
            document.getElementById("teacherMessageInput").style.display = "block";
        }


        // é¡¯ç¤ºå­¸ç”Ÿå›ç­”çµ±è¨ˆ
        function showStudentAnswers() {
            if (role === "teacher") {
                let answerList = "å­¸ç”Ÿå›ç­”çµ±è¨ˆï¼š\n";
                for (const [answer, count] of Object.entries(answerCounts)) {
                    answerList += `é¸é … ${answer}: ${count} æ¬¡\n`;
                }
                appendToChat(answerList);
            }
        }


        // é–‹å§‹æ–°å•é¡Œ
        function startNewQuestion() {
            resetAnswerCounts();
            showQuestionInput();
        // é¡¯ç¤ºç•¶å‰å•é¡Œ
    if (currentQuestion) {
        appendToChat(`<strong>ç›®å‰å•é¡Œï¼š"${currentQuestion}"</strong>`);
    }
        }

        // é‡ç½®ç­”æ¡ˆè¨ˆæ•¸
        function resetAnswerCounts() {
            answerCounts = { "1": 0, "2": 0, "3": 0, "4": 0 };
        }


        function endQuestion() {
            let statisticsMessage = "çµæœçµ±è¨ˆ:\n";
            for (let [answer, count] of Object.entries(answerCounts)) {
                statisticsMessage += `é¸é … ${answer}: ${count} äºº\n`;
            }
            appendToChat(statisticsMessage);
            resetAnswerCounts();


            currentQuestion = ""; // é‡ç½®ç›®å‰å•é¡Œ
    
            // éš±è—é¡¯ç¤ºå•é¡Œçš„ <div>
            const currentQuestionDiv = document.getElementById("currentQuestion");
            currentQuestionDiv.style.display = "none";

            document.getElementById("studentOptions").style.display = "none";
            document.getElementById("teacherMessageInput").style.display = "none";

        }

        function handleEmojiSelect(emoji) {
            const currentMessage = document.getElementById("message").value;
            document.getElementById("message").value = currentMessage + emoji;
        }

        function teacherSetNewQuestion() {
            if (role === "teacher") {
                currentQuestion = prompt("è«‹è¼¸å…¥æ–°çš„å•é¡Œï¼š");
                if (currentQuestion) {
                    appendToChat(`æ•™å¸«æå•ï¼š${currentQuestion}`);
                }
            }
        }

        function showOnlineStudents() {
            let onlineList = "ç›®å‰åœ¨ç·šå­¸ç”Ÿï¼š\n";
            onlineStudents.forEach(student => {
                onlineList += `åº§è™Ÿ ${student.id}: ${student.name}\n`;
            });
            appendToChat(onlineList);
        }

        function logout() {
            role = "";
            resetSystem();
        }

function openImageModal(imageSrc) {
    modal.style.display = "block";
    modalImage.src = imageSrc;
}

function closeImageModal() {
    modal.style.display = "none";
}



// é€å‡ºè¨Šæ¯
function sendMessage() {
    const inputMessage = document.getElementById("message").value;
    if (inputMessage.trim() === "") return; // é¿å…ç©ºè¨Šæ¯

    if (role === "teacher") {
        appendToChat(`æ•™å¸«ï¼š${inputMessage}`);
    } else {
        const studentId = document.getElementById("studentId").value;
        const studentName = document.getElementById("studentName").value;
        appendToChat(`å­¸ç”Ÿ ${studentName} (åº§è™Ÿ ${studentId})ï¼š${inputMessage}`);
    }
    document.getElementById("message").value = ""; // é€å‡ºå¾Œæ¸…ç©ºè¼¸å…¥

    // ç™¼é€è¨Šæ¯çš„å‡½æ•¸
    const defaultSocketMessage = "æ‚¨çš„è¨Šæ¯"; // æ›¿æ›ç‚ºæ‚¨çš„è¨Šæ¯å…§å®¹
    socket.emit('message', defaultSocketMessage); // ç™¼é€è¨Šæ¯
}

// æ¥æ”¶è¨Šæ¯çš„è™•ç†
socket.on('message', (message) => {
    // åœ¨é€™è£¡è™•ç†æ¥æ”¶åˆ°çš„è¨Šæ¯
    console.log('æ¥æ”¶åˆ°è¨Šæ¯:', message);
});



        // æ‰“é–‹ Emoji é¸æ“‡å™¨
        function openEmojiPicker() {
            emojiPicker.style.display = "block";
        }

        // æ’å…¥ Emoji
        function insertEmoji(emoji) {
            const messageInput = document.getElementById("message");
            messageInput.value += emoji;
            emojiPicker.style.display = "none";
        }


        // è™•ç†é¸æ“‡çš„åœ–ç‰‡
        function handleImageSelect() {
            const selectedImage = imageInput.files[0];
            if (selectedImage) {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const imageUrl = event.target.result;
                    insertImage(imageUrl);
                };
                reader.readAsDataURL(selectedImage);
            }
        }

        // æ’å…¥åœ–ç‰‡åˆ°èŠå¤©å®¤
        function insertImage(imageUrl) {
            const imageTag = `<img src="${imageUrl}" alt="åœ–ç‰‡" />`;
            appendToChat(imageTag);
        }

        // é™„åŠ è¨Šæ¯åˆ°èŠå¤©å®¤
    function appendToChat(message) {
    chatbox.innerHTML += `<p>${message}</p>`;
    chatbox.scrollTop = chatbox.scrollHeight;



    // æª¢æŸ¥æ˜¯å¦æœ‰åœ–ç‰‡ï¼Œä¸¦ç‚ºæ¯å€‹åœ–ç‰‡æ·»åŠ æ”¾å¤§åŠŸèƒ½
    const images = chatbox.getElementsByTagName("img");
    for (const image of images) {
        image.addEventListener("click", () => {
            openImageModal(image.src);
        });
    }
}

    </script>
</body>
</html>